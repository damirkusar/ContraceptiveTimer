package ch.kusar.contraceptivetimer;

import android.app.Activity;
import android.os.Bundle;
import android.view.Menu;
import android.view.View;
import android.widget.TimePicker;
import android.widget.Toast;
import android.widget.ToggleButton;
import ch.kusar.contraceptivetimer.businessobjects.ContraceptiveType;
import ch.kusar.contraceptivetimer.calculator.AlarmCalculationData;
import ch.kusar.contraceptivetimer.wrapper.AlarmManagerWrapper;
import ch.kusar.contraceptivetimer.wrapper.CalendarWrapper;

//import android.view.MenuItem;
//import android.support.v4.app.NavUtils;
public class MainActivity extends Activity {

	private ContraceptiveType contraceptiveType;

	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		this.setContentView(R.layout.activity_main);

		// TODO Remove it when it goes live.
		AlarmManagerWrapper alarmManagerWrapper = new AlarmManagerWrapper();
		alarmManagerWrapper.SetAlarm();

		this.setupViews();

	}

	private void setupViews() {
		TimePicker tp = (TimePicker) this.findViewById(R.id.timePicker);
		tp.setIs24HourView(true);
	}

	public void onToggleButtonPillClicked(View view) {
		boolean on = ((ToggleButton) view).isChecked();
		if (on) {
			this.contraceptiveType = ContraceptiveType.CONTRACEPTION_PILL;
			this.turnToggleButtonOff(false, true, true);
		}
	}

	public void onToggleButtonPatchClicked(View view) {
		boolean on = ((ToggleButton) view).isChecked();
		if (on) {
			this.contraceptiveType = ContraceptiveType.CONTRACEPTION_PATCH;
			this.turnToggleButtonOff(true, false, true);
		}
	}

	public void onToggleButtonRingClicked(View view) {
		boolean on = ((ToggleButton) view).isChecked();
		if (on) {
			this.contraceptiveType = ContraceptiveType.CONTRACEPTION_RING;
			this.turnToggleButtonOff(true, true, false);
		}
	}

	private void turnToggleButtonOff(boolean pill, boolean patch, boolean ring) {

		ToggleButton tbPill = (ToggleButton) this.findViewById(R.id.toggleButton_Pill);
		ToggleButton tbPatch = (ToggleButton) this.findViewById(R.id.toggleButton_Patch);
		ToggleButton tbRing = (ToggleButton) this.findViewById(R.id.toggleButton_Ring);

		if (pill) {
			tbPill.setChecked(false);
		}
		if (patch) {
			tbPatch.setChecked(false);
		}
		if (ring) {
			tbRing.setChecked(false);
		}
	}

	public void onToggleButtonAlarmClicked(View view) {
		boolean on = ((ToggleButton) view).isChecked();
		if (on) {
			AlarmCalculationData acd = new AlarmCalculationData();
			acd.setAlarmActive(true);
			acd.setAlarmTimeHourOfDay(20);
			acd.setAlarmTimeMinuteOfDay(0);
			acd.setContraceptiveType(this.contraceptiveType);
			acd.setLastBreakDayOfYear(CalendarWrapper.getTodayAsDayOfYear());
			acd.setLastUseOfContraceptiveDayOfYear(CalendarWrapper.getTodayOneWeekAgoAsDayOfYear());
			Toast.makeText(this, acd.toString(), Toast.LENGTH_LONG);
		}
	}

	// TODO: Remove Menu?!
	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		this.getMenuInflater().inflate(R.menu.activity_main, menu);
		return true;
	}
}
